<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Disease List</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<style>
		/* Style the table */
		table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
		}

		/* Style table headers */
		th {
			background-color: #007bff;
			color: #fff;
			padding: 10px;
			text-align: left;
		}

		/* Style table rows */
		tr:nth-child(even) {
			background-color: #f2f2f2;
		}

		tr:nth-child(odd) {
			background-color: #ffffff;
		}

		/* Style table cells */
		td {
			padding: 10px;
			text-align: left;
		}

		/* Style the "Actions" column buttons */
		.edit-button,
		.delete-button {
			padding: 5px 10px;
			margin: 0 5px;
			cursor: pointer;
			border: none;
		}

		.edit-button {
			background-color: #28a745;
			color: #fff;
		}

		.delete-button {
			background-color: #dc3545;
			color: #fff;
		}

		/* Center the buttons vertically */
		.actions {
			display: flex;
			align-items: center;
		}
	</style>

</head>

<body>
	<h1>Disease List</h1>
	<table>
		<thead>
			<tr>
				<th>ID</th>
				<th>Name</th>
				<th>ICD Code</th>
				<th>Description</th>
				<th>Status</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			<!-- Iterate over the list of diseases and display each row -->
			<tr th:each="disease : ${diseases}">
				<td th:text="${disease.disc_id}"></td>
				<td th:text="${disease.disc_name}"></td>
				<td th:text="${disease.disc_icdcode}"></td>
				<td th:text="${disease.disc_desc}"></td>
				<td th:text="${disease.disc_status}"></td>
				<td>
					<button th:onclick="editDisease(this)" class="edit-button">Edit</button>
					<button th:onclick="deleteDisease(this)" class="delete-button">Delete</button>
				</td>
			</tr>
		</tbody>
	</table>
	<script>
		function editDisease(buttonElement) {
			var parentRow = buttonElement.parentNode.parentNode;

			var Id = parentRow.cells[0].textContent;
			var name = parentRow.cells[1].textContent;
			var ICDCode = parentRow.cells[2].textContent;
			var Description = parentRow.cells[3].textContent;
			var status = parentRow.cells[4].textContent;

			parentRow.removeChild(parentRow.cells[2]); // Remove cell 2 again to adjust for removed cell
			parentRow.removeChild(parentRow.cells[2]); // Remove cell 3
			parentRow.removeChild(parentRow.cells[2]); // Remove cell 4
			parentRow.removeChild(parentRow.cells[2]); // Remove cell 5

			var cell2 = document.createElement("td");
			var cell21 = document.createElement("input");
			cell21.setAttribute("id", "ICDCode");
			cell21.setAttribute("name", "ICDCode");
			cell21.setAttribute("value", ICDCode);
			cell2.appendChild(cell21);

			var cell3 = document.createElement("td");
			var cell31 = document.createElement("input");
			cell31.setAttribute("id", "Description");
			cell31.setAttribute("name", "Description");
			cell31.setAttribute("value", Description);
			cell3.appendChild(cell31);

			var cell4 = document.createElement("td");
			var cell41 = document.createElement("input");
			cell41.setAttribute("id", "status");
			cell41.setAttribute("name", "status");
			cell41.setAttribute("value", status);
			cell4.appendChild(cell41);

			var cell5 = document.createElement("td");
			cell5.innerHTML = `
				<button onclick="saveDisease(this)" class="edit-button">Save</button>
				<button onclick="deleteDisease(this)" class="delete-button">Delete</button>
			`;

			parentRow.appendChild(cell2);
			parentRow.appendChild(cell3);
			parentRow.appendChild(cell4);
			parentRow.appendChild(cell5);
		}

		function deleteDisease(id) {
			console.log(id);
		}

		function saveDisease(buttonElement) {
			
			var parentRow = buttonElement.parentNode.parentNode;

			var Id = parentRow.cells[0].textContent;
			var name = parentRow.cells[1].textContent;
			var ICDCode = parentRow.cells[2].firstChild.value;
			var Description = parentRow.cells[3].firstChild.value;
			var status = parentRow.cells[4].firstChild.value;
			
			
			$.ajax({
				url : "/editDisease?name=" + name + "&ICDCode=" + ICDCode + "&Description=" + Description + "&Status=" + status,
				method : "POST",
				success : function(message){
					window.alert(message);
					location.reload();
				},
				error : function(xhr, status, error){
					console.error("Error Occured: ", status, error);
				}
			});
		}
	</script>

</body>

</html>